/* sigmajs.org - an open-source light-weight JavaScript graph drawing library - Version: 0.1 - Author:  Alexis Jacomy - License: MIT */
var sigma={tools:{},classes:{},instances:{}};
(function(){Array.prototype.some||(Array.prototype.some=function(n,t){var m=this.length;if("function"!=typeof n)throw new TypeError;for(var r=0;r<m;r++)if(r in this&&n.call(t,this[r],r,this))return!0;return!1});Array.prototype.forEach||(Array.prototype.forEach=function(n,t){var m=this.length;if("function"!=typeof n)throw new TypeError;for(var r=0;r<m;r++)r in this&&n.call(t,this[r],r,this)});Array.prototype.map||(Array.prototype.map=function(n,t){var m=this.length;if("function"!=typeof n)throw new TypeError;
for(var r=Array(m),s=0;s<m;s++)s in this&&(r[s]=n.call(t,this[s],s,this));return r});Array.prototype.filter||(Array.prototype.filter=function(n,t){var m=this.length;if("function"!=typeof n)throw new TypeError;for(var r=[],s=0;s<m;s++)if(s in this){var z=this[s];n.call(t,z,s,this)&&r.push(z)}return r});Object.keys||(Object.keys=function(){var n=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),m="toString toLocaleString valueOf hasOwnProperty isPrototypeOf propertyIsEnumerable constructor".split(" "),
r=m.length;return function(s){if("object"!==typeof s&&"function"!==typeof s||null===s)throw new TypeError("Object.keys called on non-object");var z=[],x;for(x in s)n.call(s,x)&&z.push(x);if(t)for(x=0;x<r;x++)n.call(s,m[x])&&z.push(m[x]);return z}}())})();sigma.classes.Cascade=function(){this.p={};this.config=function(n,t){if("string"==typeof n&&void 0==t)return this.p[n];var m="object"==typeof n&&void 0==t?n:{};"string"==typeof n&&(m[n]=t);for(var r in m)void 0!=this.p[r]&&(this.p[r]=m[r]);return this}};
sigma.classes.EventDispatcher=function(){var n={},t=this;this.one=function(m,r){if(!r||!m)return t;("string"==typeof m?m.split(" "):m).forEach(function(m){n[m]||(n[m]=[]);n[m].push({h:r,one:!0})});return t};this.bind=function(m,r){if(!r||!m)return t;("string"==typeof m?m.split(" "):m).forEach(function(m){n[m]||(n[m]=[]);n[m].push({h:r,one:!1})});return t};this.unbind=function(m,r){m||(n={});var s="string"==typeof m?m.split(" "):m;r?s.forEach(function(m){n[m]&&(n[m]=n[m].filter(function(m){return m.h!=
r}));n[m]&&0==n[m].length&&delete n[m]}):s.forEach(function(m){delete n[m]});return t};this.dispatch=function(m,r){n[m]&&(n[m].forEach(function(n){n.h({type:m,content:r,target:t})}),n[m]=n[m].filter(function(m){return!m.one}));return t}};
(function(){function n(d,p){function g(){sigma.chronos.removeTask("node_"+a.id,2).removeTask("edge_"+a.id,2).removeTask("label_"+a.id,2).stopTasks();return a}function c(b,c){a.domElements[b]=document.createElement(c);a.domElements[b].style.position="absolute";a.domElements[b].setAttribute("id","sigma_"+b+"_"+a.id);a.domElements[b].setAttribute("class","sigma_"+b+"_"+c);a.domElements[b].setAttribute("width",a.width+"px");a.domElements[b].setAttribute("height",a.height+"px");a.domRoot.appendChild(a.domElements[b]);
return a}function f(){a.p.drawHoverNodes&&a.graph.checkHover(a.mousecaptor.mouseX,a.mousecaptor.mouseY);a.p.drawHoverEdges&&(a.graph.checkHoverEdge(a.mousecaptor.mouseX,a.mousecaptor.mouseY,a.mousecaptor.ratio,a.plotter.p.defaultEdgeType),a.graph.edges.forEach(function(b){b.hover&&!b.active&&a.plotter.drawHoverEdge(b)}));a.p.drawHoverNodes&&a.graph.nodes.forEach(function(b){b.hover&&!b.active&&a.plotter.drawHoverNode(b)});return a}function b(){a.p.drawActiveNodes&&a.graph.nodes.forEach(function(b){b.active&&
a.plotter.drawActiveNode(b)});return a}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var a=this,k,l,q;this.id=p.toString();this.p={auto:!0,drawNodes:2,drawEdges:1,drawLabels:2,drawEdgeLabels:2,lastNodes:2,lastEdges:0,lastLabels:2,lastEdgeLabels:2,drawHoverNodes:!0,drawActiveNodes:!0,drawHoverEdges:!1};this.domRoot=d;this.width=this.domRoot.offsetWidth;this.height=this.domRoot.offsetHeight;this.graph=new s;this.domElements={};c("edges","canvas");c("edgehover","canvas");
c("edgelabels","canvas");c("nodes","canvas");c("labels","canvas");c("hover","canvas");c("monitor","div");c("mouse","canvas");this.plotter=new t(this.domElements.nodes.getContext("2d"),this.domElements.edges.getContext("2d"),this.domElements.labels.getContext("2d"),this.domElements.edgelabels.getContext("2d"),this.domElements.hover.getContext("2d"),this.domElements.edgehover.getContext("2d"),this.graph,this.width,this.height);this.monitor=new r(this,this.domElements.monitor);this.mousecaptor=new m(this.domElements.mouse,
this.id);this.mousecaptor.bind("drag interpolate",function(b){a.draw(a.p.auto?2:a.p.drawNodes,a.p.auto?0:a.p.drawEdges,a.p.auto?2:a.p.drawLabels,a.p.auto?0:a.p.drawEdgeLabels,!0)}).bind("stopdrag stopinterpolate",function(b){a.draw(a.p.auto?2:a.p.drawNodes,a.p.auto?1:a.p.drawEdges,a.p.auto?2:a.p.drawLabels,a.p.auto?1:a.p.drawEdgeLabels,!0)}).bind("mousedown mouseup ctrlclick",function(b){k="mousedown"==b.type?"downgraph":"upgraph";a.dispatch(k);l=a.graph.nodes.filter(function(a){return!!a.hover}).map(function(a){return a.id});
l.length?("ctrlclick"==b.type?k="ctrlclicknodes":"mousedown"==b.type?k="downnodes":(k="upnodes",a.draw(a.p.auto?-1:a.p.drawNodes,a.p.auto?1:a.p.drawEdges,a.p.auto?-1:a.p.drawLabels,a.p.auto?1:a.p.drawEdgeLabels)),a.dispatch(k,l)):(l=a.graph.edges.filter(function(a){return!!a.hover}).map(function(a){return a.id}),l.length&&(k="upedges","ctrlclick"==b.type?k="ctrlclickedges":"mousedown"==b.type&&(k="downedges"),a.dispatch(k,l)))}).bind("rightclick dblclick",function(b){l=a.graph.nodes.filter(function(a){return!!a.hover}).map(function(a){return a.id});
l.length?(k="dblclick"==b.type?"dblclicknodes":"rightclicknodes",a.dispatch(k,l)):(l=a.graph.edges.filter(function(a){return!!a.hover}).map(function(a){return a.id}),l.length&&(k="dblclick"==b.type?"dblclickedges":"rightclickedges",a.dispatch(k,l)))}).bind("move",function(b){"downgraph"==k||"downedges"==k?(a.mousecaptor.drag(),a.refresh()):"downnodes"==k?(a.graph.translateNodes(l,b.content.dX,b.content.dY,b.content.stageX,b.content.stageY,b.content.ratio),a.domElements.hover.getContext("2d").clearRect(0,
0,a.domElements.hover.width,a.domElements.hover.height),a.draw(a.p.auto?2:a.p.drawNodes,a.p.auto?2:a.p.drawEdges,a.p.auto?2:a.p.drawLabels,a.p.auto?0:a.p.drawEdgeLabels)):a.refresh()});sigma.chronos.bind("startgenerators",function(){sigma.chronos.getGeneratorsIDs().some(function(b){return!!b.match(RegExp("_ext_"+a.id+"$",""))})&&(void 0===q&&(q=a.p.drawHoverEdges,a.p.drawHoverEdges=!1),a.draw(a.p.auto?2:a.p.drawNodes,a.p.auto?0:a.p.drawEdges,a.p.auto?2:a.p.drawLabels,a.p.auto?0:a.p.drawEdgeLabels))}).bind("stopgenerators",
function(){a.p.drawHoverEdges=q;q=void 0;a.draw()});for(var v=0;v<E.plugins.length;v++)E.plugins[v](this);this.draw=function(b,c,f,h,d){if(d&&sigma.chronos.getGeneratorsIDs().some(function(b){return!!b.match(RegExp("_ext_"+a.id+"$",""))}))return a;b=void 0==b?a.p.drawNodes:b;c=void 0==c?a.p.drawEdges:c;d=void 0==f?a.p.drawLabels:f;f=void 0==f?a.p.drawEdgeLabels:h;h={nodes:b,edges:c,labels:d,edgeLabels:f};a.p.lastNodes=b;a.p.lastEdges=c;a.p.lastLabels=d;a.p.lastEdgeLabels=f;g();a.graph.rescale(a.width,
a.height,0<b,0<c).setBorders();a.mousecaptor.checkBorders(a.graph.borders,a.width,a.height);a.graph.translate(a.mousecaptor.stageX,a.mousecaptor.stageY,a.mousecaptor.ratio,0<b,0<c);a.dispatch("graphscaled");for(var k in a.domElements)"canvas"==a.domElements[k].nodeName.toLowerCase()&&(void 0==h[k]||0<=h[k])&&a.domElements[k].getContext("2d").clearRect(0,0,a.domElements[k].width,a.domElements[k].height);a.plotter.currentEdgeIndex=0;a.plotter.currentNodeIndex=0;a.plotter.currentLabelIndex=0;a.plotter.currentEdgeLabelIndex=
0;k=null;h=!1;if(f)if(1<f)for(;a.plotter.task_drawEdgeLabel(););else k?sigma.chronos.queueTask(a.plotter.task_drawEdgeLabel,"label_"+a.id,k):sigma.chronos.addTask(a.plotter.task_drawEdgeLabel,"label_"+a.id,!1),h=!0,k="label_"+a.id;if(b)if(1<b)for(;a.plotter.task_drawNode(););else sigma.chronos.addTask(a.plotter.task_drawNode,"node_"+a.id,!1),h=!0,k="node_"+a.id;if(d)if(1<d)for(;a.plotter.task_drawLabel(););else k?sigma.chronos.queueTask(a.plotter.task_drawLabel,"label_"+a.id,k):sigma.chronos.addTask(a.plotter.task_drawLabel,
"label_"+a.id,!1),h=!0,k="label_"+a.id;if(c)if(1<c)for(;a.plotter.task_drawEdge(););else k?sigma.chronos.queueTask(a.plotter.task_drawEdge,"edge_"+a.id,k):sigma.chronos.addTask(a.plotter.task_drawEdge,"edge_"+a.id,!1),h=!0,k="edge_"+a.id;a.dispatch("draw");a.refresh();h&&sigma.chronos.runTasks();return a};this.resize=function(b,c){var f=a.width,h=a.height;void 0!=b&&void 0!=c?(a.width=b,a.height=c):(a.width=a.domRoot.offsetWidth,a.height=a.domRoot.offsetHeight);if(f!=a.width||h!=a.height){for(var d in a.domElements)a.domElements[d].setAttribute("width",
a.width+"px"),a.domElements[d].setAttribute("height",a.height+"px");a.plotter.resize(a.width,a.height);a.draw(a.p.lastNodes,a.p.lastEdges,a.p.lastLabels,a.p.lastEdgeLabels,!0)}return a};this.refresh=function(){a.domElements.hover.getContext("2d").clearRect(0,0,a.domElements.hover.width,a.domElements.hover.height);a.domElements.edgehover.getContext("2d").clearRect(0,0,a.domElements.edgehover.width,a.domElements.edgehover.height);f();b();return a};this.drawHover=f;this.drawActive=b;this.clearSchedule=
g;window.addEventListener("resize",function(){a.resize()})}function t(d,p,g,c,f,b,a,k,l){function q(b){var c=b.source.displayX,f=b.source.displayY,d=b.target.displayX,k=b.target.displayY,g=b.color;if(!g)switch(h.p.edgeColor){case "source":g=b.source.color||h.p.defaultNodeColor;break;case "target":g=b.target.color||h.p.defaultNodeColor;break;default:g=h.p.defaultEdgeColor}var l=p;l.arrow=function(a,b,c,f,d){var k=f/2,A=d/2;this.fillStyle=g||h.p.defaultEdgeColor;this.translate(a,b);this.rotate(c);this.translate(-k,
-A);this.beginPath();this.moveTo(0,0);this.lineTo(0,1*d);this.lineTo(1*f,1*A);this.closePath();this.fill();this.translate(k,A);this.rotate(-c);this.translate(-a,-b)};var D=b.displaySize/3;switch(a.edgeType||h.p.defaultEdgeType){case "curve":l.strokeStyle=g;l.lineWidth=D;l.beginPath();var v=(c+d)/2+(k-f)/4,u=(f+k)/2+(c-d)/4;if(a.oriented)var q=Math.round(10*b.target.displaySize)/10+2+1.5*D,n=Math.sqrt(Math.pow(d-v,2)+Math.pow(k-u,2)),r=Math.round((d-v)*q/n),q=Math.round((k-u)*q/n),d=d-r,k=k-q;l.moveTo(c,
f);l.quadraticCurveTo(v,u,d,k);l.stroke();a.oriented&&l.arrow(d,k,Math.atan2(k-u,d-v),3*D,3*D);break;default:l.strokeStyle=g,l.lineWidth=D,l.beginPath(),a.oriented&&(q=Math.round(10*b.target.displaySize)/10+2+1.5*D,n=Math.sqrt(Math.pow(d-c,2)+Math.pow(k-f,2)),r=Math.round((d-c)*q/n),q=Math.round((k-f)*q/n),d-=r,k-=q),l.moveTo(c,f),l.lineTo(d,k),l.stroke(),a.oriented&&l.arrow(d,k,Math.atan2(k-f,d-c),3*D,3*D)}b.hover&&m(b);return h}function v(c){if(c.source==c.target||void 0==c.label||!c.label.length)return h;
var f="fixed"==h.p.edgeLabelSize?h.p.defaultEdgeLabelSize:h.p.edgeLabelSizeRatio*c.displaySize;if(f>=2.3*h.p.edgeLabelThreshold||c.forceLabel){var d=b,k=c.source.displayX,g=c.source.displayY,l=c.target.displayX,q=c.target.displayY,v;d.font=(h.p.hoverFontStyle||h.p.fontStyle||"")+" "+f+"px "+(h.p.hoverFont||h.p.font||"");v=d.measureText(c.label).width;switch(a.edgeType||h.p.defaultEdgeType){case "curve":g=sigma.tools.pointOnQuadraticCurve(0.5,k,g,l,q,(k+l)/2+(q-g)/4,(g+q)/2+(k-l)/4);k=g.x;g=g.y;break;
default:k=(k+l)/2,g=(g+q)/2}"none"!=h.p.edgeHoverLabelBGColor&&(d.fillStyle="edge"==h.p.edgeHoverLabelBGColor?c.color||h.p.defaultEdgeHoverColor:h.p.defaultEdgeHoverLabelBGColor,d.fillRect(Math.round(k-v/2),Math.round(g-f/2),v,f));d.fillStyle="edge"==h.p.edgeHoverLabelColor?c.color||h.p.defaultEdgeHoverColor:h.p.defaultEdgeHoverLabelColor;d.fillText(c.label,Math.round(k-v/2),Math.round(g+f/2))}return h}function u(a){var b=f,c="fixed"==h.p.labelSize?h.p.defaultLabelSize:h.p.labelSizeRatio*a.displaySize;
b.font=(h.p.hoverFontStyle||h.p.fontStyle||"")+" "+c+"px "+(h.p.hoverFont||h.p.font||"");b.fillStyle="node"==h.p.labelHoverBGColor?a.color||h.p.defaultNodeColor:h.p.defaultHoverLabelBGColor;b.beginPath();h.p.labelHoverShadow&&(b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=4,b.shadowColor=h.p.labelHoverShadowColor);sigma.tools.drawRoundRect(b,Math.round(a.displayX-c/2-2),Math.round(a.displayY-c/2-2),Math.round(b.measureText(a.label).width+1.5*a.displaySize+c/2+4),Math.round(c+4),Math.round(c/2+
2),"left");b.closePath();b.fill();b.shadowOffsetX=0;b.shadowOffsetY=0;b.shadowBlur=0;b.beginPath();b.fillStyle="node"==h.p.nodeBorderColor?a.color||h.p.defaultNodeColor:h.p.defaultNodeBorderColor;b.arc(Math.round(a.displayX),Math.round(a.displayY),a.displaySize+h.p.borderSize,0,2*Math.PI,!0);b.closePath();b.fill();b.beginPath();b.fillStyle="node"==h.p.nodeHoverColor?a.color||h.p.defaultNodeColor:h.p.defaultNodeHoverColor;b.arc(Math.round(a.displayX),Math.round(a.displayY),a.displaySize,0,2*Math.PI,
!0);b.closePath();b.fill();b.fillStyle="node"==h.p.labelHoverColor?a.color||h.p.defaultNodeColor:h.p.defaultLabelHoverColor;b.fillText(a.label,Math.round(a.displayX+1.5*a.displaySize),Math.round(a.displayY+c/2-3));return h}function m(c){var f=b,d=c.source.displayX,k=c.source.displayY,g=c.target.displayX,l=c.target.displayY,q;if(!(e.hidden||!h.isOnScreen(c.source)&&!h.isOnScreen(c.target))){switch(h.p.edgeHoverColor){case "source":q=c.source.color||h.p.defaultNodeColor;break;case "target":q=c.target.color||
h.p.defaultNodeColor;break;case "edge":q=c.color||h.p.defaultEdgeHoverColor;break;default:q=h.p.defaultEdgeHoverColor}f.arrow=function(a,b,c,f,d){var h=f/2,k=d/2;this.fillStyle=q;this.translate(a,b);this.rotate(c);this.translate(-h,-k);this.beginPath();this.moveTo(0,0);this.lineTo(0,1*d);this.lineTo(1*f,1*k);this.closePath();this.fill();this.translate(h,k);this.rotate(-c);this.translate(-a,-b)};var u=c.displaySize*h.p.edgeHoverSizeRatio/3;switch(a.edgeType||h.p.defaultEdgeType){case "curve":f.strokeStyle=
q;f.lineWidth=u;f.beginPath();var p=(d+g)/2+(l-k)/4,n=(k+l)/2+(d-g)/4;if(a.oriented)var r=Math.round(10*c.target.displaySize)/10+2+1.5*u,F=Math.sqrt(Math.pow(g-p,2)+Math.pow(l-n,2)),s=Math.round((g-p)*r/F),r=Math.round((l-n)*r/F),g=g-s,l=l-r;f.moveTo(d,k);f.quadraticCurveTo(p,n,g,l);f.stroke();a.oriented&&f.arrow(g,l,Math.atan2(l-n,g-p),3*u,3*u);break;default:f.strokeStyle=q,f.lineWidth=u,f.beginPath(),a.oriented&&(r=Math.round(10*c.target.displaySize)/10+2+1.5*u,F=Math.sqrt(Math.pow(g-d,2)+Math.pow(l-
k,2)),s=Math.round((g-d)*r/F),r=Math.round((l-k)*r/F),g-=s,l-=r),f.moveTo(d,k),f.lineTo(g,l),f.stroke(),a.oriented&&f.arrow(g,l,Math.atan2(l-k,g-d),3*u,3*u)}v(c);h.p.hoverSourceOnEdgeHover&&(c.source.hover=!0);h.p.hoverTargetOnEdgeHover&&(c.target.hover=!0);return h}}function n(a){if(isNaN(a.x)||isNaN(a.y))throw Error("A node's coordinate is not a number (id: "+a.id+")");return!a.hidden&&a.displayX+a.displaySize>-r/3&&a.displayX-a.displaySize<4*r/3&&a.displayY+a.displaySize>-s/3&&a.displayY-a.displaySize<
4*s/3}sigma.classes.Cascade.call(this);var h=this;this.p={labelColor:"default",defaultLabelColor:"#000",labelHoverBGColor:"default",defaultHoverLabelBGColor:"#fff",labelHoverShadow:!0,labelHoverShadowColor:"#000",labelHoverColor:"default",defaultLabelHoverColor:"#000",labelActiveBGColor:"default",defaultActiveLabelBGColor:"#fff",labelActiveShadow:!0,labelActiveShadowColor:"#000",labelActiveColor:"default",defaultLabelActiveColor:"#000",labelSize:"fixed",defaultLabelSize:12,labelSizeRatio:2,labelThreshold:6,
font:"Arial",hoverFont:"",activeFont:"",fontStyle:"",hoverFontStyle:"",activeFontStyle:"",edgeLabelSize:"fixed",defaultEdgeLabelSize:12,edgeLabelSizeRatio:1,edgeLabelThreshold:6,defaultEdgeLabelColor:"#000",defaultEdgeLabelBGColor:"rgba(255,255,255,0.7)",defaultEdgeHoverLabelColor:"#000",defaultEdgeHoverLabelBGColor:"rgba(255,255,255,0.7)",edgeLabelColor:"default",edgeLabelBGColor:"default",edgeHoverLabelColor:"default",edgeHoverLabelBGColor:"edge",edgeColor:"source",defaultEdgeColor:"#aaa",defaultEdgeType:"line",
edgeHoverSizeRatio:1,edgeHoverColor:"default",defaultEdgeHoverColor:"#aaa",hoverSourceOnEdgeHover:!1,hoverTargetOnEdgeHover:!1,defaultNodeColor:"#aaa",nodeHoverColor:"node",defaultNodeHoverColor:"#fff",nodeActiveColor:"node",defaultNodeActiveColor:"#fff",borderSize:0,nodeBorderColor:"node",defaultNodeBorderColor:"#fff",edgesSpeed:200,nodesSpeed:200,labelsSpeed:200,edgeLabelsSpeed:200};var r=k,s=l;this.currentEdgeLabelIndex=this.currentLabelIndex=this.currentNodeIndex=this.currentEdgeIndex=0;this.task_drawLabel=
function(){for(var b=a.nodes.length,c=0;c++<h.p.labelsSpeed&&h.currentLabelIndex<b;)if(h.isOnScreen(a.nodes[h.currentLabelIndex])){var f=a.nodes[h.currentLabelIndex++],d=g;if(f.displaySize>=h.p.labelThreshold||f.forceLabel){var k="fixed"==h.p.labelSize?h.p.defaultLabelSize:h.p.labelSizeRatio*f.displaySize;d.font=h.p.fontStyle+k+"px "+h.p.font;d.fillStyle="node"==h.p.labelColor?f.color||h.p.defaultNodeColor:h.p.defaultLabelColor;d.fillText(f.label,Math.round(f.displayX+1.5*f.displaySize),Math.round(f.displayY+
k/2-3))}}else h.currentLabelIndex++;return h.currentLabelIndex<b};this.task_drawEdgeLabel=function(){for(var b=a.edges.length,f,d,k=0;k++<h.p.edgeLabelsSpeed&&h.currentEdgeLabelIndex<b;)if(e=a.edges[h.currentEdgeLabelIndex],f=e.source,d=e.target,e.hidden||!h.isOnScreen(f)&&!h.isOnScreen(d))h.currentEdgeLabelIndex++;else if(f=a.edges[h.currentEdgeLabelIndex++],!(f.source==f.target||void 0==f.label||!f.label.length))if(d="fixed"==h.p.edgeLabelSize?h.p.defaultEdgeLabelSize:h.p.edgeLabelSizeRatio*f.displaySize,
d>=2.3*h.p.edgeLabelThreshold||f.forceLabel){var g=c,l=f.source.displayX,q=f.source.displayY,u=f.target.displayX,v=f.target.displayY,p=void 0,m=void 0,n=void 0;g.font=(h.p.hoverFontStyle||h.p.fontStyle||"")+" "+d+"px "+(h.p.hoverFont||h.p.font||"");n=g.measureText(f.label).width;switch(a.edgeType||h.p.defaultEdgeType){case "curve":l=sigma.tools.pointOnQuadraticCurve(0.5,l,q,u,v,(l+u)/2+(v-q)/4,(q+v)/2+(l-u)/4);p=l.x;m=l.y;break;default:p=(l+u)/2,m=(q+v)/2}g.strokeStyle="edge"==h.p.edgeLabelBGColor?
f.color||h.p.defaultEdgeHoverColor:h.p.defaultEdgeLabelBGColor;g.strokeText(f.label,Math.round(p-n/2),Math.round(m+d/2));g.fillStyle="edge"==h.p.edgeLabelColor?f.color||h.p.defaultEdgeColor:h.p.defaultEdgeLabelColor;g.fillText(f.label,Math.round(p-n/2),Math.round(m+d/2))}return h.currentEdgeLabelIndex<b};this.task_drawEdge=function(){for(var b=a.edges.length,c,f,d=0;d++<h.p.edgesSpeed&&h.currentEdgeIndex<b;)e=a.edges[h.currentEdgeIndex],c=e.source,f=e.target,e.hidden||c.hidden||f.hidden||!h.isOnScreen(c)&&
!h.isOnScreen(f)?h.currentEdgeIndex++:q(a.edges[h.currentEdgeIndex++]);return h.currentEdgeIndex<b};this.task_drawNode=function(){for(var b=a.nodes.length,c=0;c++<h.p.nodesSpeed&&h.currentNodeIndex<b;)if(h.isOnScreen(a.nodes[h.currentNodeIndex])){var f=a.nodes[h.currentNodeIndex++],k=Math.round(10*f.displaySize)/10,g=d;g.fillStyle=f.color;g.beginPath();g.arc(f.displayX,f.displayY,k,0,2*Math.PI,!0);g.closePath();g.fill();f.hover&&u(f)}else h.currentNodeIndex++;return h.currentNodeIndex<b};this.drawActiveNode=
function(a){var b=f;if(!n(a))return h;var c="fixed"==h.p.labelSize?h.p.defaultLabelSize:h.p.labelSizeRatio*a.displaySize;b.font=(h.p.activeFontStyle||h.p.fontStyle||"")+" "+c+"px "+(h.p.activeFont||h.p.font||"");b.fillStyle="node"==h.p.labelHoverBGColor?a.color||h.p.defaultNodeColor:h.p.defaultActiveLabelBGColor;b.beginPath();h.p.labelActiveShadow&&(b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=4,b.shadowColor=h.p.labelActiveShadowColor);sigma.tools.drawRoundRect(b,Math.round(a.displayX-c/2-2),
Math.round(a.displayY-c/2-2),Math.round(b.measureText(a.label).width+1.5*a.displaySize+c/2+4),Math.round(c+4),Math.round(c/2+2),"left");b.closePath();b.fill();b.shadowOffsetX=0;b.shadowOffsetY=0;b.shadowBlur=0;b.beginPath();b.fillStyle="node"==h.p.nodeBorderColor?a.color||h.p.defaultNodeColor:h.p.defaultNodeBorderColor;b.arc(Math.round(a.displayX),Math.round(a.displayY),a.displaySize+h.p.borderSize,0,2*Math.PI,!0);b.closePath();b.fill();b.beginPath();b.fillStyle="node"==h.p.nodeActiveColor?a.color||
h.p.defaultNodeColor:h.p.defaultNodeActiveColor;b.arc(Math.round(a.displayX),Math.round(a.displayY),a.displaySize,0,2*Math.PI,!0);b.closePath();b.fill();b.fillStyle="node"==h.p.labelActiveColor?a.color||h.p.defaultNodeColor:h.p.defaultLabelActiveColor;b.fillText(a.label,Math.round(a.displayX+1.5*a.displaySize),Math.round(a.displayY+c/2-3));return h};this.drawHoverNode=u;this.drawHoverEdge=m;this.isOnScreen=n;this.resize=function(a,b){r=a;s=b;return h}}function m(d){function p(a){b.p.mouseEnabled&&
(c(b.mouseX,b.mouseY,b.ratio*(0<(void 0!=a.wheelDelta&&a.wheelDelta||void 0!=a.detail&&-a.detail)?b.p.zoomMultiply:1/b.p.zoomMultiply)),b.p.blockScroll&&(a.preventDefault?a.preventDefault():a.returnValue=!1))}function g(){l=b.stageX;q=b.stageY;b.startX=b.mouseX;b.startY=b.mouseY;h=n=b.stageX;s=r=b.stageY;b.dispatch("startdrag")}function c(a,c,d){if(!b.isMouseDown&&(window.clearInterval(b.interpolationID),A=void 0!=d,l=b.stageX,u=a,q=b.stageY,m=c,v=d||b.ratio,v=Math.min(Math.max(v,b.p.minRatio),b.p.maxRatio),
t=b.p.directZooming?1-(A?b.p.zoomDelta:b.p.dragDelta):0,b.ratio!=v||b.stageX!=u||b.stageY!=m))f(),b.interpolationID=window.setInterval(f,50),b.dispatch("startinterpolate")}function f(){t+=A?b.p.zoomDelta:b.p.dragDelta;t=Math.min(t,1);var a=sigma.easing.quadratic.easeout(t),c=b.ratio;b.ratio=c*(1-a)+v*a;A?(b.stageX=u+(b.stageX-u)*b.ratio/c,b.stageY=m+(b.stageY-m)*b.ratio/c):(b.stageX=l*(1-a)+u*a,b.stageY=q*(1-a)+m*a);b.dispatch("interpolate");1<=t&&(window.clearInterval(b.interpolationID),a=b.ratio,
A?(b.ratio=v,b.stageX=u+(b.stageX-u)*b.ratio/a,b.stageY=m+(b.stageY-m)*b.ratio/a):(b.stageX=u,b.stageY=m),b.dispatch("stopinterpolate"))}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var b=this;this.p={minRatio:1,maxRatio:32,marginRatio:1,zoomDelta:0.1,dragDelta:0.3,zoomMultiply:2,directZooming:!1,blockScroll:!0,inertia:1.1,mouseEnabled:!0};var a=0,k=0;b.startX=0;var l=b.startY=0,q=0,v=1,u=0,m=0,n=0,h=0,r=0,s=0,t=0,A=!1,x=Date.now();this.stageY=this.stageX=0;this.ratio=
1;this.mouseY=this.mouseX=0;this.isMouseDown=!1;d.addEventListener("DOMMouseScroll",p,!0);d.addEventListener("mousewheel",p,!0);d.addEventListener("mousemove",function(c){a=b.mouseX;k=b.mouseY;b.mouseX=void 0!=c.offsetX&&c.offsetX||void 0!=c.layerX&&c.layerX||void 0!=c.clientX&&c.clientX;b.mouseY=void 0!=c.offsetY&&c.offsetY||void 0!=c.layerY&&c.layerY||void 0!=c.clientY&&c.clientY;b.dispatch("move",{dX:b.mouseX-a,dY:b.mouseY-k,stageX:b.stageX,stageY:b.stageY,ratio:b.ratio});c.preventDefault?c.preventDefault():
c.returnValue=!1},!0);d.addEventListener("mousedown",function(c){if(b.p.mouseEnabled){var f=Date.now();400>f-x?b.dispatch("dblclick"):x=f;if(c.ctrlKey||c.metaKey)b.dispatch("ctrlclick");else switch(c.which){case 1:b.isMouseDown=!0;a=b.mouseX;k=b.mouseY;b.dispatch("mousedown");g();break;case 2:b.dispatch("rightclick");break;case 3:b.dispatch("rightclick");break;default:b.isMouseDown=!0,a=b.mouseX,k=b.mouseY,b.dispatch("mousedown"),g()}c.preventDefault?c.preventDefault():c.returnValue=!1}},!0);document.addEventListener("mouseup",
function(a){b.p.mouseEnabled&&b.isMouseDown&&(b.isMouseDown=!1,b.dispatch("mouseup"),(l!=b.stageX||q!=b.stageY)&&c(b.stageX+b.p.inertia*(b.stageX-h),b.stageY+b.p.inertia*(b.stageY-s)),a.preventDefault?a.preventDefault():a.returnValue=!1)},!0);this.checkBorders=function(a,c,f){return b};this.interpolate=c;this.drag=function(){var a=b.mouseX-b.startX+l,c=b.mouseY-b.startY+q;if(a!=b.stageX||c!=b.stageY)h=n,s=r,n=a,r=c,b.stageX=a,b.stageY=c,b.dispatch("drag")}}function r(d,p){function g(){var f;f="<p>GLOBAL :</p>";
for(var b in c.p.globalProbes)f+="<p>"+b+" : "+c.p.globalProbes[b]()+"</p>";f+="<br><p>LOCAL :</p>";for(b in c.p.localProbes)f+="<p>"+b+" : "+c.p.localProbes[b]()+"</p>";c.p.dom.innerHTML=f;return c}sigma.classes.Cascade.call(this);var c=this;this.instance=d;this.monitoring=!1;this.p={fps:40,dom:p,globalProbes:{"Time (ms)":sigma.chronos.getExecutionTime,Queue:sigma.chronos.getQueuedTasksCount,Tasks:sigma.chronos.getTasksCount,FPS:sigma.chronos.getFPS},localProbes:{"Nodes count":function(){return c.instance.graph.nodes.length},
"Edges count":function(){return c.instance.graph.edges.length}}};this.activate=function(){c.monitoring||(c.monitoring=window.setInterval(g,1E3/c.p.fps));return c};this.desactivate=function(){c.monitoring&&(window.clearInterval(c.monitoring),c.monitoring=null,c.p.dom.innerHTML="");return c}}function s(){function d(c){return{x:c.x,y:c.y,size:c.size,degree:c.degree,inDegree:c.inDegree,outDegree:c.outDegree,displayX:c.displayX,displayY:c.displayY,displaySize:c.displaySize,label:c.label,id:c.id,color:c.color,
fixed:c.fixed,active:c.active,hidden:c.hidden,forceLabel:c.forceLabel,attr:c.attr}}function p(c){return{source:c.source.id,target:c.target.id,size:c.size,type:c.type,weight:c.weight,displaySize:c.displaySize,label:c.label,hidden:c.hidden,id:c.id,attr:c.attr,color:c.color}}function g(){c.nodes=[];c.nodesIndex={};c.edges=[];c.edgesIndex={};return c}sigma.classes.Cascade.call(this);sigma.classes.EventDispatcher.call(this);var c=this;this.p={minNodeSize:0,maxNodeSize:0,minEdgeSize:0,maxEdgeSize:0,scalingMode:"inside",
nodesPowRatio:0.5,edgesPowRatio:0,safe:!0};this.borders={};g();this.addNode=function(f,b){if(c.nodesIndex[f])throw Error('Node "'+f+'" already exists.');b=b||{};var a={x:0,y:0,size:1,degree:0,inDegree:0,outDegree:0,fixed:!1,active:!1,hidden:!1,forceLabel:!1,label:f.toString(),id:f.toString(),attr:{}},d;for(d in b)switch(d){case "id":break;case "x":case "y":case "size":a[d]=+b[d];break;case "fixed":case "active":case "hidden":case "forceLabel":a[d]=!!b[d];break;case "color":case "label":a[d]=b[d];
break;case "attributes":for(var g in b[d])void 0!=b[d][g].attr&&void 0!=b[d][g].val&&(a.attr[b[d][g].attr]=b[d][g].val);break;default:void 0!=b[d]&&(a.attr[d]=b[d])}c.nodes.push(a);c.nodesIndex[f.toString()]=a;return c};this.addEdge=function(d,b,a,g){if(c.edgesIndex[d])throw Error('Edge "'+d+'" already exists.');if(!c.nodesIndex[b])throw Error("Edge's source \""+b+'" does not exist yet.');if(!c.nodesIndex[a])throw Error("Edge's target \""+a+'" does not exist yet.');g=g||{};b={source:c.nodesIndex[b],
target:c.nodesIndex[a],size:1,weight:1,displaySize:0.5,label:d.toString(),id:d.toString(),hidden:!1,attr:{}};b.source.degree++;b.source.outDegree++;b.target.degree++;b.target.inDegree++;for(var l in g)switch(l){case "id":case "source":case "target":break;case "hidden":b[l]=!!g[l];break;case "size":case "weight":b[l]=+g[l];break;case "color":b[l]=g[l].toString();break;case "type":b[l]=g[l].toString();break;case "label":b[l]=g[l];break;case "attributes":for(var q in g[l])void 0!=g[l][q].attr&&void 0!=
g[l][q].val&&(b.attr[g[l][q].attr]=g[l][q].val);break;default:void 0!=g[l]&&(b.attr[l]=g[l])}c.edges.push(b);c.edgesIndex[d.toString()]=b;return c};this.dropNode=function(d){var b=(d instanceof Array?d:[d])||[];b.forEach(function(a){if(c.nodesIndex[a]){var b=null;c.nodes.some(function(c,d){return c.id==a?(b=d,!0):!1});null!=b&&c.nodes.splice(b,1);delete c.nodesIndex[a]}else sigma.log('Node "'+a+'" does not exist.')});c.edges=c.edges.filter(function(a){return-1!=b.indexOf(a.source.id)?(delete c.edgesIndex[a.id],
a.target.degree--,a.target.inDegree--,!1):-1!=b.indexOf(a.target.id)?(delete c.edgesIndex[a.id],a.source.degree--,a.source.outDegree--,!1):!0});return c};this.dropEdge=function(d){((d instanceof Array?d:[d])||[]).forEach(function(b){if(c.edgesIndex[b]){c.edgesIndex[b].source.degree--;c.edgesIndex[b].source.outDegree--;c.edgesIndex[b].target.degree--;c.edgesIndex[b].target.inDegree--;var a=null;c.edges.some(function(c,d){return c.id==b?(a=d,!0):!1});null!=a&&c.edges.splice(a,1);delete c.edgesIndex[b]}else sigma.log('Edge "'+
b+'" does not exist.')});return c};this.iterEdges=function(d,b){var a=b?b.map(function(a){return c.edgesIndex[a]}):c.edges;if(c.p.safe){var g=a.map(p);g.forEach(d);a.forEach(function(a,b){var d=g[b],f;for(f in d)switch(f){case "id":case "displaySize":break;case "weight":case "size":a[f]=+d[f];break;case "source":case "target":a[f]=c.nodesIndex[f]||a[f];break;case "hidden":a[f]=!!d[f];break;case "color":case "label":case "type":a[f]=(d[f]||"").toString();break;default:a[f]=d[f]}})}else a.forEach(d);
return c};this.iterNodes=function(f,b){var a=b?b.map(function(a){return c.nodesIndex[a]}):c.nodes;if(c.p.safe){var g=a.map(d);g.forEach(f);a.forEach(function(a,b){var c=g[b],d;for(d in c)switch(d){case "id":case "attr":case "degree":case "inDegree":case "outDegree":case "displayX":case "displayY":case "displaySize":break;case "x":case "y":case "size":a[d]=+c[d];break;case "fixed":case "active":case "hidden":case "forceLabel":a[d]=!!c[d];break;case "color":case "label":a[d]=(c[d]||"").toString();break;
default:a[d]=c[d]}})}else a.forEach(f);return c};this.getEdges=function(d){var b=(d instanceof Array?d:[d])||[];c.p.safe?b.map(function(a){return p(c.edgesIndex[a])}):b.map(function(a){return c.edgesIndex[a]});return d instanceof Array?b:b[0]};this.getNodes=function(f){var b=(f instanceof Array?f:[f])||[];c.p.safe?b.map(function(a){return d(c.nodesIndex[a])}):b.map(function(a){return c.nodesIndex[a]});return f instanceof Array?b:b[0]};this.empty=g;this.rescale=function(d,b,a,g){var l=0,q=0;a&&c.nodes.forEach(function(a){q=
Math.max(a.size,q)});g&&c.edges.forEach(function(a){l=Math.max(a.size,l)});var q=q||1,l=l||1,p,m;!c.p.maxNodeSize&&!c.p.minNodeSize?(p=1,m=0):c.p.maxNodeSize==c.p.minNodeSize?(p=0,m=c.p.maxNodeSize):(p=(c.p.maxNodeSize-c.p.minNodeSize)/q,m=c.p.minNodeSize);var n,r;!c.p.maxEdgeSize&&!c.p.minEdgeSize?(n=1,r=0):(n=c.p.maxEdgeSize==c.p.minEdgeSize?0:(c.p.maxEdgeSize-c.p.minEdgeSize)/l,r=c.p.minEdgeSize);a&&c.nodes.forEach(function(a){a.displaySize=Math.sqrt((a.size*p+m)/Math.PI);a.fixed||(a.displayX=
a.x,a.displayY=a.y)});g&&c.edges.forEach(function(a){a.displaySize=a.size*n+r});return c};this.translate=function(d,b,a,g,l){var q=Math.pow(a,c.p.nodesPowRatio);g&&c.nodes.forEach(function(c){c.fixed||(c.displayX=c.displayX*a+d,c.displayY=c.displayY*a+b);c.displaySize*=q});q=Math.pow(a,c.p.edgesPowRatio);l&&c.edges.forEach(function(a){a.displaySize*=q});return c};this.translateNodes=function(d,b,a,g,l,q){d.forEach(function(d){d=c.nodesIndex[d];d.x=(d.displayX-g+b)/q;d.y=(d.displayY-l+a)/q});return c};
this.setBorders=function(){c.borders={};c.nodes.forEach(function(d){c.borders.minX=Math.min(void 0==c.borders.minX?d.displayX-d.displaySize:c.borders.minX,d.displayX-d.displaySize);c.borders.maxX=Math.max(void 0==c.borders.maxX?d.displayX+d.displaySize:c.borders.maxX,d.displayX+d.displaySize);c.borders.minY=Math.min(void 0==c.borders.minY?d.displayY-d.displaySize:c.borders.minY,d.displayY-d.displaySize);c.borders.maxY=Math.max(void 0==c.borders.maxY?d.displayY-d.displaySize:c.borders.maxY,d.displayY-
d.displaySize)})};this.checkHover=function(d,b){var a,g,l,q=[],p=[];c.nodes.forEach(function(c){if(c.hidden)c.hover=!1;else{a=Math.abs(c.displayX-d);g=Math.abs(c.displayY-b);l=c.displaySize;var m=c.hover,n=a<l&&g<l&&Math.sqrt(a*a+g*g)<l;m&&!n?(c.hover=!1,p.push(c.id)):n&&!m&&(c.hover=!0,q.push(c.id))}});q.length&&c.dispatch("overnodes",q);p.length&&c.dispatch("outnodes",p);return c};this.checkHoverEdge=function(d,b,a,g){var l,p,m,n,r,s,h,t,x,z,A,G,w,y=[],B=[],C=18*Math.abs(Math.log(1/(a*a)))||100;
c.edges.forEach(function(a){if(a.hidden)a.hover=!1;else{r=a.source.displayX;s=a.source.displayY;x=a.source.displaySize;h=a.target.displayX;t=a.target.displayY;z=a.target.displaySize;A=a.displaySize;G=a.hover;w=!1;l=Math.abs(r-d);p=Math.abs(s-b);m=Math.abs(h-d);n=Math.abs(t-b);if(!(r==h&&s==t||l<x&&p<x||m<z&&n<z))switch(c.edgeType||g){case "curve":(w=sigma.tools.isOnQuadraticCurve(d,b,r,s,h,t,(r+h)/2+(t-s)/4,(s+t)/2+(r-h)/4,A,C))&&y.push(a.id);break;default:(w=sigma.tools.isOnSegment(d,b,r,s,h,t,A,
C))&&y.push(a.id)}a.hover=w;G&&!w&&B.push(a.id)}});y.length&&c.dispatch("overedges",y);B.length&&c.dispatch("outedges",B);return c}}function z(d){var p=this;sigma.classes.EventDispatcher.call(this);this._core=d;this.kill=function(){};this.getID=function(){return d.id};this.configProperties=function(g,c){var f=d.config(g,c);return f==d?p:f};this.drawingProperties=function(g,c){var f=d.plotter.config(g,c);return f==d.plotter?p:f};this.mouseProperties=function(g,c){var f=d.mousecaptor.config(g,c);return f==
d.mousecaptor?p:f};this.graphProperties=function(g,c){var f=d.graph.config(g,c);return f==d.graph?p:f};this.getMouse=function(){return{mouseX:d.mousecaptor.mouseX,mouseY:d.mousecaptor.mouseY,down:d.mousecaptor.isMouseDown}};this.position=function(g,c,f){if(0==arguments.length)return{stageX:d.mousecaptor.stageX,stageY:d.mousecaptor.stageY,ratio:d.mousecaptor.ratio};d.mousecaptor.stageX=void 0!=g?g:d.mousecaptor.stageX;d.mousecaptor.stageY=void 0!=c?c:d.mousecaptor.stageY;d.mousecaptor.ratio=void 0!=
f?f:d.mousecaptor.ratio;return p};this.goTo=function(g,c,f){d.mousecaptor.interpolate(g,c,f);return p};this.zoomTo=function(g,c,f){f=Math.min(Math.max(d.mousecaptor.config("minRatio"),f),d.mousecaptor.config("maxRatio"));f==d.mousecaptor.ratio?d.mousecaptor.interpolate(g-d.width/2+d.mousecaptor.stageX,c-d.height/2+d.mousecaptor.stageY):d.mousecaptor.interpolate((f*g-d.mousecaptor.ratio*d.width/2)/(f-d.mousecaptor.ratio),(f*c-d.mousecaptor.ratio*d.height/2)/(f-d.mousecaptor.ratio),f);return p};this.resize=
function(g,c){d.resize(g,c);return p};this.draw=function(g,c,f,b,a){d.draw(g,c,f,b,a);return p};this.refresh=function(){d.refresh();return p};this.addGenerator=function(g,c,f){sigma.chronos.addGenerator(g+"_ext_"+d.id,c,f);return p};this.removeGenerator=function(g){sigma.chronos.removeGenerator(g+"_ext_"+d.id);return p};this.addNode=function(g,c){d.graph.addNode(g,c);return p};this.addEdge=function(g,c,f,b){d.graph.addEdge(g,c,f,b);return p};this.dropNode=function(g){d.graph.dropNode(g);return p};
this.dropEdge=function(g){d.graph.dropEdge(g);return p};this.pushGraph=function(g,c){g.nodes&&g.nodes.forEach(function(f){f.id&&(!c||!d.graph.nodesIndex[f.id])&&p.addNode(f.id,f)});g.edges&&g.edges.forEach(function(f){(validID=f.source&&f.target&&f.id)&&(!c||!d.graph.edgesIndex[f.id])&&p.addEdge(f.id,f.source,f.target,f)});return p};this.emptyGraph=function(){d.graph.empty();return p};this.getNodesCount=function(){return d.graph.nodes.length};this.getEdgesCount=function(){return d.graph.edges.length};
this.iterNodes=function(g,c){d.graph.iterNodes(g,c);return p};this.iterEdges=function(g,c){d.graph.iterEdges(g,c);return p};this.getNodes=function(g){return d.graph.getNodes(g)};this.getEdges=function(g){return d.graph.getEdges(g)};this.activateMonitoring=function(){return d.monitor.activate()};this.desactivateMonitoring=function(){return d.monitor.desactivate()};d.bind("downnodes upnodes downedges upedges downgraph upgraph ctrlclicknodes rightclicknodes dblclicknodes ctrlclickedges rightclickedges dblclickedges",
function(d){p.dispatch(d.type,d.content)});d.graph.bind("overnodes outnodes overedges outedges",function(d){p.dispatch(d.type,d.content)})}var x=0,E={plugins:[]};sigma.init=function(d){d=new n(d,(++x).toString());sigma.instances[x]=new z(d);return sigma.instances[x]};sigma.tools.drawRoundRect=function(d,p,g,c,f,b,a){b=b?b:0;var k=a?a:[],k="string"==typeof k?k.split(" "):k;a=b&&(0<=k.indexOf("topleft")||0<=k.indexOf("top")||0<=k.indexOf("left"));var l=b&&(0<=k.indexOf("topright")||0<=k.indexOf("top")||
0<=k.indexOf("right")),q=b&&(0<=k.indexOf("bottomleft")||0<=k.indexOf("bottom")||0<=k.indexOf("left")),k=b&&(0<=k.indexOf("bottomright")||0<=k.indexOf("bottom")||0<=k.indexOf("right"));d.moveTo(p,g+b);a?d.arcTo(p,g,p+b,g,b):d.lineTo(p,g);l?(d.lineTo(p+c-b,g),d.arcTo(p+c,g,p+c,g+b,b)):d.lineTo(p+c,g);k?(d.lineTo(p+c,g+f-b),d.arcTo(p+c,g+f,p+c-b,g+f,b)):d.lineTo(p+c,g+f);q?(d.lineTo(p+b,g+f),d.arcTo(p,g+f,p,g+f-b,b)):d.lineTo(p,g+f);d.lineTo(p,g+b)};sigma.tools.getRGB=function(d,p){d=d.toString();var g=
{r:0,g:0,b:0};if(3<=d.length&&"#"==d.charAt(0)){var c=d.length-1;6==c?g={r:parseInt(d.charAt(1)+d.charAt(2),16),g:parseInt(d.charAt(3)+d.charAt(4),16),b:parseInt(d.charAt(5)+d.charAt(5),16)}:3==c&&(g={r:parseInt(d.charAt(1)+d.charAt(1),16),g:parseInt(d.charAt(2)+d.charAt(2),16),b:parseInt(d.charAt(3)+d.charAt(3),16)})}p&&(g=[g.r,g.g,g.b]);return g};sigma.tools.rgbToHex=function(d,p,g){return sigma.tools.toHex(d)+sigma.tools.toHex(p)+sigma.tools.toHex(g)};sigma.tools.toHex=function(d){d=parseInt(d,
10);if(isNaN(d))return"00";d=Math.max(0,Math.min(d,255));return"0123456789ABCDEF".charAt((d-d%16)/16)+"0123456789ABCDEF".charAt(d%16)};sigma.tools.isOnSegment=function(d,p,g,c,f,b,a,k){return Math.min(g,f)<d&&d<Math.max(g,f)&&Math.min(c,b)<p&&p<Math.max(c,b)?Math.abs((p-c)*(f-g)-(d-g)*(b-c))<a*k:!1};sigma.tools.pointOnQuadraticCurve=function(d,p,g,c,f,b,a){return{x:Math.pow(1-d,2)*p+2*(1-d)*d*b+Math.pow(d,2)*c,y:Math.pow(1-d,2)*g+2*(1-d)*d*a+Math.pow(d,2)*f}};sigma.tools.isOnQuadraticCurve=function(d,
p,g,c,f,b,a,k,l,q){var m=Math.sqrt(Math.pow(g-f,2)+Math.pow(c-b,2));if(Math.abs(d-g)>m||Math.abs(p-c)>m)return!1;var n=Math.sqrt(Math.pow(g-d,2)+Math.pow(c-p,2)),r=Math.sqrt(Math.pow(f-d,2)+Math.pow(b-p,2)),m=0.5,n=n<r?-0.1:0.1;q=Math.log(1+l)*q/20;r=sigma.tools.pointOnQuadraticCurve(m,g,c,f,b,a,k);for(r=Math.sqrt(Math.pow(d-r.x,2)+Math.pow(p-r.y,2));0<=m&&1>=m&&r>q&&(0.025<n||-0.025>n);)l=r,r=sigma.tools.pointOnQuadraticCurve(m,g,c,f,b,a,k),r=Math.sqrt(Math.pow(d-r.x,2)+Math.pow(p-r.y,2)),r>l?(n=
-n/2,m+=n):0>m+n||1<m+n?(n/=2,r=l):m+=n;return r<q};sigma.chronos=new function(){function d(a){window.setTimeout(a,0);return q}function m(){for(q.dispatch("frameinserted");n&&y.length&&g(););!n||!y.length?f():(A=(new Date).getTime(),t++,G=z-h,x=h-G,q.dispatch("insertframe"),d(m))}function g(){C%=y.length;if(!y[C].task()){var a=y[C].taskName;B=B.filter(function(b){b.taskParent==a&&y.push({taskName:b.taskName,task:b.task});return b.taskParent!=a});q.dispatch("killed",y.splice(C--,1)[0])}C++;z=(new Date).getTime()-
A;return z<=x}function c(){n=!0;t=C=0;E=A=(new Date).getTime();q.dispatch("start");q.dispatch("insertframe");d(m);return q}function f(){q.dispatch("stop");n=!1;return q}function b(a,b,d){if("function"!=typeof a)throw Error('Task "'+b+'" is not a function');y.push({taskName:b,task:a});n=!(!n&&!(d&&c()||1));return q}function a(a){return a?Object.keys(w).filter(function(a){return!!w[a].on}).length:Object.keys(w).length}function k(){Object.keys(w).length?(q.dispatch("startgenerators"),q.unbind("killed",
l),d(function(){for(var a in w)w[a].on=!0,b(w[a].task,a,!1)}),q.bind("killed",l).runTasks()):q.dispatch("stopgenerators");return q}function l(b){void 0!=w[b.content.taskName]&&(w[b.content.taskName].del||!w[b.content.taskName].condition()?delete w[b.content.taskName]:w[b.content.taskName].on=!1,0==a(!0)&&k())}sigma.classes.EventDispatcher.call(this);var q=this,n=!1,r=80,s=0,t=0,h=1E3/r,x=h,z=0,E=0,A=0,G=0,w={},y=[],B=[],C=0;this.frequency=function(a){return void 0!=a?(r=Math.abs(1*a),h=1E3/r,t=0,
q):r};this.runTasks=c;this.stopTasks=f;this.insertFrame=d;this.addTask=b;this.queueTask=function(a,b,c){if("function"!=typeof a)throw Error('Task "'+b+'" is not a function');if(!y.concat(B).some(function(a){return a.taskName==c}))throw Error('Parent task "'+c+'" of "'+b+'" is not attached.');B.push({taskParent:c,taskName:b,task:a});return q};this.removeTask=function(a,b){if(void 0==a)y=[],1==b?B=[]:2==b&&(y=B,B=[]),f();else{var c="string"==typeof a?a:"";y=y.filter(function(b){return("string"==typeof a?
b.taskName==a:b.task==a)?(c=b.taskName,!1):!0});0<b&&(B=B.filter(function(a){1==b&&a.taskParent==c&&y.push(a);return a.taskParent!=c}))}n=!(y.length&&(!f()||1));return q};this.addGenerator=function(b,c,d){if(void 0!=w[b])return q;w[b]={task:c,condition:d};0==a(!0)&&k();return q};this.removeGenerator=function(a){w[a]&&(w[a].on=!1,w[a].del=!0);return q};this.startGenerators=k;this.getGeneratorsIDs=function(){return Object.keys(w)};this.getFPS=function(){n&&(s=Math.round(1E4*(t/((new Date).getTime()-
E)))/10);return s};this.getTasksCount=function(){return y.length};this.getQueuedTasksCount=function(){return B.length};this.getExecutionTime=function(){return A-E};return this};sigma.easing={linear:{},quadratic:{}};sigma.easing.linear.easenone=function(d){return d};sigma.easing.quadratic.easein=function(d){return d*d};sigma.easing.quadratic.easeout=function(d){return-d*(d-2)};sigma.easing.quadratic.easeinout=function(d){return 1>(d*=2)?0.5*d*d:-0.5*(--d*(d-2)-1)};sigma.addPlugin=function(d,m,g){z.prototype[d]=
m;E.plugins.push(g)};sigma.debugMode=0;sigma.log=function(){if(1==sigma.debugMode)for(var d in arguments)console.log(arguments[d]);else if(1<sigma.debugMode)for(d in arguments)throw Error(arguments[d]);return sigma};sigma.publicPrototype=z.prototype})();
